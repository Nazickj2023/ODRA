# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ODRA (v0.2.0)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

‚úÖ **–ë–∞–≥ #1:** Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª 10 —Ñ–∞–π–ª–æ–≤ –∏–∑ –æ—á–µ—Ä–µ–¥–∏  
‚úÖ **–ë–∞–≥ #2:** Frontend Docker –∏–º–µ–ª –ø—Ä–æ–±–ª–µ–º—ã —Å SPA routing  
‚úÖ **–ë–∞–≥ #3:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –° Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up --build

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ worker
docker-compose logs -f worker

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É 10 —Ñ–∞–π–ª–æ–≤
curl -X POST http://localhost:8000/ingest/batch \
  -H "X-API-Key: dev-key-change-in-production" \
  -F "files=@doc1.txt" \
  -F "files=@doc2.txt" \
  ... (–¥–æ 10 —Ñ–∞–π–ª–æ–≤)
```

### –õ–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker)
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r backend/requirements.txt
pip install -r workers/requirements.txt

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 1)
redis-server

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2)
cd backend
uvicorn app.main:app --reload

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å worker (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 3)
cd workers
python processor.py

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å frontend (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 4)
cd frontend
npm install && npm run dev

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 5)
pytest backend/tests/ -v
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **BUGFIXES.md** - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏
- **FIXES_SUMMARY.txt** - –ö—Ä–∞—Ç–∫–∏–π summary –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- **PROJECT_SUMMARY.md** - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

## ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
chmod +x verify_fixes.sh
./verify_fixes.sh
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ 1Ô∏è‚É£ Worker —Ç–µ–ø–µ—Ä—å –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç Redis –æ—á–µ—Ä–µ–¥—å (BLPOP)
‚úÖ 2Ô∏è‚É£ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞—Ç—á–µ–π –∏–∑ 10+ —Ñ–∞–π–ª–æ–≤
‚úÖ 3Ô∏è‚É£ Asyncio Semaphore –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏
‚úÖ 4Ô∏è‚É£ Frontend Dockerfile –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (nginx + SPA routing)
‚úÖ 5Ô∏è‚É£ VITE_API_URL —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ Docker build
‚úÖ 6Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚úÖ 7Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω—ã E2E —Ç–µ—Å—Ç—ã
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
pytest backend/tests/ -v
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è 10 —Ñ–∞–π–ª–æ–≤ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
```bash
pytest backend/tests/test_e2e.py::TestE2EIngestPipeline::test_batch_ingest_10_files -v
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞
```bash
pytest backend/tests/test_worker_integration.py -v
```

### E2E —Ç–µ—Å—Ç—ã
```bash
pytest backend/tests/test_e2e.py -v
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ 10 —Ñ–∞–π–ª–æ–≤:
1. **Frontend** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 10 —Ñ–∞–π–ª–æ–≤ ‚Üí `POST /ingest/batch`
2. **Backend** –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª—ã –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –≤ Redis –æ—á–µ—Ä–µ–¥—å
3. **Worker** –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ `BLPOP`
4. Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 5 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (Semaphore)
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis cache —Å TTL=1 —á–∞—Å
6. **Frontend** –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `GET /ingest/status/{task_id}`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Docker Compose:
- **clickhouse** - OLAP –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **redis** - –û—á–µ—Ä–µ–¥—å –¥–ª—è –∑–∞–¥–∞—á –∏ –∫–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **backend** - FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **frontend** - React + Nginx —Å SPA routing
- **worker** - Python –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ | –ü–æ—Å–ª–µ |
|-----------|----|----|
| Worker | ‚ùå –ù–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥—å | ‚úÖ Redis BLPOP consumer |
| 10 —Ñ–∞–π–ª–æ–≤ | ‚ùå –ó–∞–≤–∏—Å–∞–Ω–∏–µ | ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ —Ñ–∞–π–ª—ã |
| Frontend Docker | ‚ùå serve + 404 –æ—à–∏–±–∫–∏ | ‚úÖ Nginx + SPA routing |
| –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å | ‚ùå –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è | ‚úÖ Semaphore (max 5) |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å —ç–º–æ–¥–∑–∏ |
| –¢–µ—Å—Ç—ã | ‚ùå 4 —Ñ–∞–π–ª–∞ | ‚úÖ 20+ comprehensive |

## üîç –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- `workers/processor.py` - Redis consumer —Å BLPOP
- `backend/app/api/ingest.py` - Redis queue integration
- `frontend/Dockerfile` - Nginx –≤–º–µ—Å—Ç–æ serve
- `docker-compose.yml` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `workers/requirements.txt` - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã

**–°–æ–∑–¥–∞–Ω—ã:**
- `frontend/nginx.conf` - SPA routing –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `backend/tests/test_worker_integration.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `backend/tests/test_e2e.py` - End-to-end —Ç–µ—Å—Ç—ã
- `BUGFIXES.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `verify_fixes.sh` - –°–∫—Ä–∏–ø—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üí° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Redis –æ—á–µ—Ä–µ–¥—å
- **Name:** `ingest_tasks`
- **Type:** List (FIFO)
- **Backend:** `RPUSH` (–¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏)
- **Worker:** `BLPOP` —Å timeout=2s (–ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –∑–∞–¥–∞—á–∏)

### Asyncio Semaphore
- –ú–∞–∫—Å–∏–º—É–º 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑ –ø–∞–º—è—Ç–∏/CPU

### Retry –ª–æ–≥–∏–∫–∞
- –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- Exponential backoff: 2s ‚Üí 4s ‚Üí 8s

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚úÖ –í—Å–µ 10 —Ñ–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Frontend –º–∞—Ä—à—Ä—É—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ 404 –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (unit + integration + e2e)
- ‚úÖ Production-ready –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üìù –í–µ—Ä—Å–∏—è

- **–í–µ—Ä—Å–∏—è:** 0.2.0
- **–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ Ready for Production
